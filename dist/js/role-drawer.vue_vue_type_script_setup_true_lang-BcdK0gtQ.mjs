var u=(g,f,o)=>new Promise((n,m)=>{var p=r=>{try{s(o.next(r))}catch(i){m(i)}},a=r=>{try{s(o.throw(r))}catch(i){m(i)}},s=r=>r.done?n(r.value):Promise.resolve(r.value).then(p,a);s((o=o.apply(g,f)).next())});import{$ as v}from"./bootstrap-CIlPtDbU.mjs";import{u as D}from"./vxe-table-CS5KFeE-.mjs";import{r as x,e as A}from"./index-DV03ZwLB.mjs";import{d as B,g as L,h as T}from"./index-BQjO2Nl8.mjs";import{_ as M}from"./tree-select-panel.vue_vue_type_script_setup_true_lang-D0vP0S2i.mjs";import{d as $}from"./data-BPjxELxr.mjs";import{a9 as b,Q as C,J as K,a3 as P,at as R,au as U,av as k,n as S,a8 as d,ar as J}from"../jse/index-index-CulmqKVw.mjs";import{u as N}from"./use-drawer-0pSlBI5S.mjs";const X=b({__name:"role-drawer",emits:["reload"],setup(g,{emit:f}){const o=f,n=C(!1),m=K(()=>n.value?v("pages.common.edit"):v("pages.common.add")),[p,a]=D({commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-2"},layout:"vertical",schema:$(),showDefaultActions:!1,wrapperClass:"grid-cols-2"}),s=C([]);function r(t){return u(this,null,function*(){if(t){const e=yield x(t);a.setFieldValue("menuIds",e.checkedKeys),s.value=e.menus}else{const e=yield A();a.setFieldValue("menuIds",[]),s.value=e}})}const[i,c]=N({onCancel:_,onConfirm:V,onOpenChange(t){return u(this,null,function*(){if(!t)return null;c.drawerLoading(!0);const{id:e}=c.getData();if(n.value=!!e,n.value&&e){const l=yield B(e);yield a.setValues(l)}yield r(e),c.drawerLoading(!1)})}}),y=C();function V(){return u(this,null,function*(){var t,e,l;try{c.drawerLoading(!0);const{valid:w}=yield a.validate();if(!w)return;const F=(l=(e=(t=y.value)==null?void 0:t[0])==null?void 0:e.getCheckedKeys())!=null?l:[],h=P(yield a.getValues());h.menuIds=F,yield n.value?L(h):T(h),o("reload"),yield _()}catch(w){console.error(w)}finally{c.drawerLoading(!1)}})}function _(){return u(this,null,function*(){c.close(),yield a.resetForm()})}function I(t){a.setFieldValue("menuCheckStrictly",t)}return(t,e)=>(R(),U(d(i),{"close-on-click-modal":!1,title:m.value,class:"w-[600px]"},{default:k(()=>[S(d(p),null,{menuIds:k(l=>[S(d(M),J({ref_key:"menuSelectRef",ref:y},l,{"check-strictly":d(a).form.values.menuCheckStrictly,"tree-data":s.value,onCheckStrictlyChange:I}),null,16,["check-strictly","tree-data"])]),_:1})]),_:1},8,["title"]))}});export{X as _};
