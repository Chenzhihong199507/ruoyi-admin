var q=Object.defineProperty;var I=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var S=(r,s,o)=>s in r?q(r,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[s]=o,B=(r,s)=>{for(var o in s||(s={}))O.call(s,o)&&S(r,o,s[o]);if(I)for(var o of I(s))P.call(s,o)&&S(r,o,s[o]);return r};var d=(r,s,o)=>new Promise((f,v)=>{var p=l=>{try{g(o.next(l))}catch(h){v(h)}},N=l=>{try{g(o.throw(l))}catch(h){v(h)}},g=l=>l.done?f(l.value):Promise.resolve(l.value).then(p,N);g((o=o.apply(r,s)).next())});import{I as D,u as z,$ as C,aq as j,k as A,M as E,bC as M,cC as F}from"./bootstrap-CIlPtDbU.mjs";import{I as G}from"./vxe-table-CS5KFeE-.mjs";import{h as W}from"./index-YggHP7OK.mjs";import{a as H}from"./download-BHYXKq0m.mjs";import{S as K}from"./index-BLUbi1M4.mjs";import{_ as Q}from"./page.vue_vue_type_script_setup_true_lang-BEwXti9W.mjs";import{a9 as U,Q as $,ak as J,b2 as X,br as Z,at as c,au as u,av as a,n as w,a8 as n,aC as V,ap as x,aD as _,aG as T,az as ee}from"../jse/index-index-CulmqKVw.mjs";import{u as te}from"./use-vxe-grid-CIpB4HOm.mjs";import{T as oe}from"./index-CbGq_Vdo.mjs";import{S as ie}from"./index-CeJhG9t7.mjs";import{P as re}from"./index-BLw-otuj.mjs";import"./render-C5tDa4zc.mjs";import"./data-CRYXvPFo.mjs";import"./index-BsPmTjuM.mjs";import"./colors-DLErT_a-.mjs";import"./dict-D8K1MO7Q.mjs";import"./index-B9BKRmLN.mjs";import"./index-CY4pGJKi.mjs";import"./Col-CY1020A8.mjs";import"./responsiveObserve-CKY_yQR9.mjs";import"./useFlexGapSupport-UdCnRdDh.mjs";import"./Trigger-CxuUq1Ff.mjs";import"./ResizeObserver.es-CDE7jhPe.mjs";import"./get-vP85LLZV.mjs";import"./useRefs-DXDFWT8O.mjs";import"./collapseMotion-BYkmK0aG.mjs";import"./debounce-iPjm31B_.mjs";import"./FormItemContext-D-XKVqk8.mjs";import"./isPlainObject-D3JZnYxx.mjs";import"./EyeOutlined-Bhfo9c26.mjs";import"./CheckOutlined-CIq9xGup.mjs";import"./useMergedState-DtLgCtQF.mjs";import"./uuid-BthZQwsx.mjs";import"./index-B-WsVPHD.mjs";import"./statusUtils-C-zQFcRu.mjs";import"./slide-B9Yt64p6.mjs";import"./index-CwX3_37I.mjs";import"./List-B93VJ5nE.mjs";import"./index-yiE2I97I.mjs";import"./Checkbox-C1LX6amp.mjs";import"./index-uwSnP2fA.mjs";import"./eagerComputed-Bboi8kUT.mjs";import"./index-epHOG_uQ.mjs";import"./index-MMlqTCj9.mjs";import"./index-aPtpRG1I.mjs";import"./Group-B1PMGyxu.mjs";import"./index-CkI6h8s8.mjs";import"./loading-7m7uS9S_.mjs";import"./index-crWPCwF-.mjs";function se(r){return D.get("/resource/oss/list",{params:r})}function ae(r){return D.get(`/resource/oss/download/${r}`,{responseType:"blob",timeout:30*1e3,isTransformResponse:!1})}function L(r){return D.deleteWithMsg(`/resource/oss/${r}`)}const ne=()=>[{component:"Input",fieldName:"fileName",label:"文件名"},{component:"Input",fieldName:"originalName",label:"原名"},{component:"Input",fieldName:"fileSuffix",label:"拓展名"},{component:"Input",fieldName:"service",label:"服务商"},{component:"RangePicker",fieldName:"createTime",label:"创建时间"}],le=[{type:"checkbox",width:60},{title:"文件名",field:"fileName",showOverflow:!0},{title:"文件原名",field:"originalName",showOverflow:!0},{title:"文件拓展名",field:"fileSuffix"},{title:"文件预览",field:"url",showOverflow:!0,slots:{default:"url"}},{title:"创建时间",field:"createTime",sortable:!0},{title:"上传人",field:"createByName"},{title:"服务商",field:"service"},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",width:180}],me={key:1},at=U({__name:"index",setup(r){const s={commonConfig:{labelWidth:80},schema:ne(),wrapperClass:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},o={checkboxConfig:{highlight:!0,reserve:!0},columns:le,height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:(k,...m)=>d(this,[k,...m],function*({page:i,sort:t},e={}){e!=null&&e.createTime?(e.params={beginTime:M(e.createTime[0]).format("YYYY-MM-DD 00:00:00"),endTime:M(e.createTime[1]).format("YYYY-MM-DD 23:59:59")},Reflect.deleteProperty(e,"createTime")):Reflect.deleteProperty(e,"params");const y=B({pageNum:i.currentPage,pageSize:i.pageSize},e);return F(t)||(y.orderByColumn=t.field,y.isAsc=t.order),yield se(y)})}},rowConfig:{isHover:!0,keyField:"ossId",height:65},sortConfig:{remote:!0},round:!0,align:"center",showOverflow:!0},f=$(!1),[v,p]=te({formOptions:s,gridOptions:o,gridEvents:{sortChange:()=>{p.query()},checkboxChange:i=>{f.value=i.records.length>0},checkboxAll:i=>{f.value=i.records.length>0}}});function N(i){return d(this,null,function*(){const t=A.loading(C("pages.common.downloadLoading"),0);try{const e=yield ae(i.ossId);H(e,i.originalName)}finally{t()}})}function g(i){return d(this,null,function*(){yield L(i.ossId),yield p.query()})}function l(){const t=p.grid.getCheckboxRecords().map(e=>e.ossId);E.confirm({title:"提示",okType:"danger",content:`确认删除选中的${t.length}条记录吗？`,onOk:()=>d(this,null,function*(){yield L(t),yield p.query()})})}const h=z();function R(){h.push("/system/oss-config")}const b=$(!1);J(()=>d(this,null,function*(){const i=yield W("sys.oss.previewListResource");b.value=!!i}));function Y(i){return["jpg","jpeg","png","gif","webp"].some(e=>i.toLocaleLowerCase().includes(e))}return(i,t)=>{const e=X("a-button"),k=Z("access");return c(),u(n(Q),{"auto-content-height":!0},{default:a(()=>[w(n(v),null,{"toolbar-actions":a(()=>t[2]||(t[2]=[V("span",{class:"pl-[7px] text-[16px]"},"文件列表",-1)])),"toolbar-tools":a(()=>[w(n(K),null,{default:a(()=>[w(n(oe),{title:"预览图片"},{default:a(()=>[w(n(ie),{checked:b.value,"onUpdate:checked":t[0]||(t[0]=m=>b.value=m)},null,8,["checked"])]),_:1}),x((c(),u(e,{onClick:R},{default:a(()=>t[3]||(t[3]=[_(" 配置管理 ")])),_:1})),[[k,["system:ossConfig:list"],"code"]]),x((c(),u(e,{disabled:!f.value,danger:"",type:"primary",onClick:l},{default:a(()=>[_(T(n(C)("pages.common.delete")),1)]),_:1},8,["disabled"])),[[k,["system:oss:remove"],"code"]])]),_:1})]),url:a(({row:m})=>[b.value&&Y(m.url)?(c(),u(n(G),{key:0,src:m.url,height:"50px"},null,8,["src"])):(c(),ee("span",me,T(m.url),1))]),action:a(({row:m})=>[x((c(),u(e,{size:"small",type:"link",onClick:y=>N(m)},{default:a(()=>[_(T(n(C)("pages.common.download")),1)]),_:2},1032,["onClick"])),[[k,["system:oss:edit"],"code"]]),w(n(re),{placement:"left",title:"确认删除？",onConfirm:y=>g(m)},{default:a(()=>[x((c(),u(e,{danger:"",size:"small",type:"link",onClick:t[1]||(t[1]=j(()=>{},["stop"]))},{default:a(()=>[_(T(n(C)("pages.common.delete")),1)]),_:1})),[[k,["system:oss:remove"],"code"]])]),_:2},1032,["onConfirm"])]),_:1})]),_:1})}}});export{at as default};
