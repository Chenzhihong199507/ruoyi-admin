var _=(d,n,e)=>new Promise((u,a)=>{var o=t=>{try{s(e.next(t))}catch(c){a(c)}},i=t=>{try{s(e.throw(t))}catch(c){a(c)}},s=t=>t.done?u(t.value):Promise.resolve(t.value).then(o,i);s((e=e.apply(d,n)).next())});import{N as S,h as y,k as l,Q as k,R as T,S as C,u as A}from"./bootstrap-CIlPtDbU.mjs";import{a as L}from"./oauth-common-D_5ndZBU.mjs";import{a9 as R,ak as g,az as q,at as x}from"../jse/index-index-CulmqKVw.mjs";const B="000000",F=R({__name:"index",setup(d){var f;const n=C(),e=n.query.code,u=n.query.state,a=JSON.parse(atob(u)),o=n.query.source,i=(f=a.tenantId)!=null?f:B,s=a.domain,t=S(),c=y(),w=A();return g(()=>_(this,null,function*(){const h=window.location.host;if(s!==h){const r=new URL(window.location.href);r.host=s,window.location.href=r.toString();return}try{if(!L.find(m=>m.source===o&&m.action)){l.error({content:`未找到${o}平台`});return}const p={grantType:"social",socialCode:e,socialState:u,source:o,tenantId:i};t.accessToken?(yield k(p),l.success(`${o}授权成功`)):(yield c.authLogin(p),l.success(`${o}登录成功`))}catch(r){}finally{setTimeout(()=>{w.push(T)},1500)}})),(h,r)=>(x(),q("div"))}});export{F as default};
