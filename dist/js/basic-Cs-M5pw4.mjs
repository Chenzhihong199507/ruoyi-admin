var _=(s,n,e)=>new Promise((l,o)=>{var d=r=>{try{c(e.next(r))}catch(i){o(i)}},u=r=>{try{c(e.throw(r))}catch(i){o(i)}},c=r=>r.done?l(r.value):Promise.resolve(r.value).then(d,u);c((e=e.apply(s,n)).next())});import{cE as D,bV as $,i as M,N as R,cv as V,$ as b,bC as H,bJ as U,cF as F,cz as Y,cG as O,u as C,k as T,R as J,l as Q,h as j,cH as q,f as G}from"./bootstrap-CIlPtDbU.mjs";import{P as W}from"./index-CzbPtRhx.mjs";import{e as X,f as K}from"./index-CFKk8jMF.mjs";import{u as Z}from"./dict-D8K1MO7Q.mjs";import{a9 as A,b6 as ee,b7 as te,W as k,at as L,az as B,n as v,av as h,a8 as a,as as ae,Q as S,J as x,bF as oe,ak as I,aC as se,ay as ne,au as re,a1 as ie}from"../jse/index-index-CulmqKVw.mjs";import{S as le}from"./index-B-WsVPHD.mjs";import{u as ce}from"./use-tabs-B9ecYKaP.mjs";import{_ as ue,N as pe,a as de,b as me}from"./layout.vue_vue_type_script_setup_true_lang-BjCirIC3.mjs";import{u as fe}from"./use-modal-BmBYziM1.mjs";import{_ as ve}from"./avatar.vue_vue_type_script_setup_true_lang-ChMgtFkB.mjs";import"./create-icon-DyKWIynC.mjs";import"./Trigger-CxuUq1Ff.mjs";import"./ResizeObserver.es-CDE7jhPe.mjs";import"./statusUtils-C-zQFcRu.mjs";import"./slide-B9Yt64p6.mjs";import"./index-CwX3_37I.mjs";import"./List-B93VJ5nE.mjs";import"./useMergedState-DtLgCtQF.mjs";import"./CheckOutlined-CIq9xGup.mjs";import"./FormItemContext-D-XKVqk8.mjs";import"./icon-button.vue_vue_type_script_setup_true_lang-BMSbb8G-.mjs";import"./theme-toggle.vue_vue_type_script_setup_true_lang-B13os1Cw.mjs";import"./icon.vue_vue_type_script_setup_true_lang-fivSW_wP.mjs";import"./x-BK4QZNWW.mjs";import"./use-drawer-0pSlBI5S.mjs";import"./loading-7m7uS9S_.mjs";import"./TabsList.vue_vue_type_script_setup_true_lang-_kL9V4mB.mjs";import"./rotate-cw-gdMJED4-.mjs";const he="data:image/svg+xml,%3csvg%20t='1727417479543'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4291'%20width='64'%20height='64'%3e%3cpath%20d='M240%20658.08h220.784l55.744%2065.04%2055.744-65.04h220.768V272H240v386.08z%20m-48%2032V240a16%2016%200%200%201%2016-16h617.04a16%2016%200%200%201%2016%2016v450.08a16%2016%200%200%201-16%2016H594.336l-65.664%2076.64a16%2016%200%200%201-24.304%200l-65.664-76.64H208a16%2016%200%200%201-16-16zM366.256%20498.56a33.488%2033.488%200%201%201%200-66.992%2033.488%2033.488%200%200%201%200%2066.992z%20m150.272%200a33.488%2033.488%200%201%201%200-66.992%2033.488%2033.488%200%200%201%200%2066.992z%20m150.24%200a33.488%2033.488%200%201%201%200-66.992%2033.488%2033.488%200%200%201%200%2066.992z'%20fill='%231677ff'%20p-id='4292'%3e%3c/path%3e%3c/svg%3e",ge=A({name:"LoginExpiredModal",__name:"login-expired-modal",props:ee({avatar:{default:""},codeLoginPath:{},forgetPasswordPath:{},loading:{type:Boolean},qrCodeLoginPath:{},registerPath:{},showCodeLogin:{type:Boolean},showForgetPassword:{type:Boolean},showQrcodeLogin:{type:Boolean},showRegister:{type:Boolean},showRememberMe:{type:Boolean},showThirdPartyLogin:{type:Boolean},subTitle:{},title:{},submitButtonText:{}},{open:{type:Boolean},openModifiers:{}}),emits:["update:open"],setup(s){const n=te(s,"open"),[e,l]=fe();return k(()=>n.value,o=>{l.setState({isOpen:o})}),(o,d)=>(L(),B("div",null,[v(a(e),{closable:!1,"close-on-click-modal":!1,"close-on-press-escape":!1,footer:!1,"fullscreen-button":!1,header:!1,class:"border-none px-10 py-6 text-center shadow-xl sm:w-[600px] sm:rounded-2xl md:h-[unset]"},{default:h(()=>[v(a(ve),{src:o.avatar,class:"mx-auto mb-6 size-20"},null,8,["src"]),v(a(D),{"show-forget-password":!1,"show-register":!1,"show-remember-me":!1,"sub-title":o.$t("authentication.loginAgainSubTitle"),title:o.$t("authentication.loginAgainTitle")},{default:h(()=>[ae(o.$slots,"default")]),_:3},8,["sub-title","title"])]),_:3})]))}}),{apiURL:we,clientId:_e}=U(),ye=$("app-notify",()=>{const s=S([]),n=M(),e=x(()=>{var t;return((t=n.userInfo)==null?void 0:t.userId)||"0"}),l=x(()=>s.value.filter(t=>t.userId===e.value));function o(){const m=R().accessToken,f=`${we}/resource/sse?clientid=${_e}&Authorization=Bearer ${m}`,{data:p}=oe(f,[],{autoReconnect:{delay:1e3,onFailed(){console.error("sse重连失败.")},retries:3}});k(p,y=>{y&&(console.log(`接收到消息: ${y}`),V.success({description:y,duration:3,message:b("component.notice.received")}),s.value.unshift({avatar:he,date:H().format("YYYY-MM-DD HH:mm:ss"),isRead:!1,message:y,title:b("component.notice.title"),userId:e.value}),p.value=null)})}function d(){s.value.filter(t=>t.userId===e.value).forEach(t=>{t.isRead=!0})}function u(t){!t.isRead&&(t.isRead=!0)}function c(){s.value=s.value.filter(t=>t.userId!==e.value)}function r(){}const i=x(()=>s.value.filter(t=>t.userId===e.value).some(t=>!t.isRead));return{$reset:r,clearAllMessage:c,notificationList:s,notifications:l,setAllRead:d,setRead:u,showDot:i,startListeningMessage:o}},{persist:{pick:["notificationList"]}}),E=$("app-tenant",()=>{const s=S(!1),n=S(!0),e=S([]);function l(){return _(this,null,function*(){const{tenantEnabled:u,voList:c}=yield F();n.value=u,e.value=c})}function o(u){return _(this,null,function*(){s.value=u})}function d(){s.value=!1,n.value=!0,e.value=[]}return{$reset:d,checked:s,initTenant:l,setChecked:o,tenantEnable:n,tenantList:e}}),be={key:0,class:"mr-[8px] hidden md:block"},Se=A({__name:"index",setup(s){const{hasAccessByRoles:n}=Y(),e=S(),l=S(),o=E(),{initTenant:d,setChecked:u}=o,{tenantEnable:c,tenantList:r}=O(o),i=x(()=>n(["superadmin"])&&a(c));I(()=>_(this,null,function*(){n(["superadmin"])&&(yield d())}));const{closeAllTabs:t}=ce(),m=C();function f(g){u(g),t(),m.push(J)}const p=Z(),y=(g,w)=>_(this,null,function*(){a(e)!==g&&(yield X(g),e.value=g,T.success(`${b("component.tenantToggle.switch")} ${w.companyName}`),f(!0),setTimeout(()=>p.resetCache()))});function P(){return _(this,null,function*(){yield K(),p.resetCache(),T.success(b("component.tenantToggle.reset")),e.value="",f(!1),setTimeout(()=>p.resetCache())})}function N(g,w){return w.companyName.toLowerCase().includes(g.toLowerCase())}return(g,w)=>i.value?(L(),B("div",be,[v(a(le),{value:l.value,"onUpdate:value":w[0]||(w[0]=z=>l.value=z),"field-names":{label:"companyName",value:"tenantId"},"filter-option":N,options:a(r),placeholder:a(b)("component.tenantToggle.placeholder"),"allow-clear":"",class:"w-60","show-search":"",onDeselect:P,onSelect:y},{suffixIcon:h(()=>w[1]||(w[1]=[se("span",{class:"icon-mdi--company"},null,-1)])),_:1},8,["value","options","placeholder"])])):ne("",!0)}}),xe=Q(Se,[["__scopeId","data-v-0a5312c0"]]),Ze=A({__name:"basic",setup(s){const n=M(),e=j(),l=R(),o=C(),d=E(),u=x(()=>{const m=[{handler:()=>{o.push("/profile")},icon:W,text:b("widgets.profile")}];return d.checked&&m.splice(1,1),m}),c=x(()=>{var m,f;return(f=(m=n.userInfo)==null?void 0:m.avatar)!=null?f:ie.app.defaultAvatar});function r(){return _(this,null,function*(){yield e.logout(),q()})}const i=ye();I(()=>i.startListeningMessage());function t(){T.warning("暂未开放")}return(m,f)=>(L(),re(a(me),{onClearPreferencesAndLogout:r},{"header-right-1":h(()=>[v(a(xe))]),"user-dropdown":h(()=>{var p;return[v(a(ue),{avatar:c.value,menus:u.value,text:(p=a(n).userInfo)==null?void 0:p.realName,description:"ageerle@163.com","tag-text":"Pro",onLogout:r},null,8,["avatar","menus","text"])]}),notification:h(()=>[v(a(pe),{dot:a(i).showDot,notifications:a(i).notifications,onClear:a(i).clearAllMessage,onMakeAll:a(i).setAllRead,onRead:a(i).setRead,onViewAll:t},null,8,["dot","notifications","onClear","onMakeAll","onRead"])]),extra:h(()=>[v(a(ge),{open:a(l).loginExpired,"onUpdate:open":f[0]||(f[0]=p=>a(l).loginExpired=p),avatar:c.value},{default:h(()=>[v(G)]),_:1},8,["open","avatar"])]),"lock-screen":h(()=>[v(a(de),{avatar:c.value,onToLogin:r},null,8,["avatar"])]),_:1}))}});export{Ze as default};
