var i=(s,u,r)=>new Promise((t,h)=>{var w=n=>{try{d(r.next(n))}catch(f){h(f)}},o=n=>{try{d(r.throw(n))}catch(f){h(f)}},d=n=>n.done?t(n.value):Promise.resolve(n.value).then(w,o);d((r=r.apply(s,u)).next())});import{$ as x}from"./bootstrap-CIlPtDbU.mjs";import{u as V}from"./vxe-table-CS5KFeE-.mjs";import{t as D,a as L}from"./index-DV03ZwLB.mjs";import{e as M,f as $,g as q}from"./index-DV4CYNzU.mjs";import{_ as A}from"./tree-select-panel.vue_vue_type_script_setup_true_lang-D0vP0S2i.mjs";import{T as B}from"./index-BsPmTjuM.mjs";import{a9 as _,J as T,n as m,Q as y,a3 as P,at as R,au as K,av as C,a8 as g,ar as O}from"../jse/index-index-CulmqKVw.mjs";import{u as U}from"./use-drawer-0pSlBI5S.mjs";import{l as j}from"./tree-DR0G1ezI.mjs";const te=()=>[{component:"Input",fieldName:"packageName",label:"套餐名称"}],ne=[{type:"checkbox",width:60},{title:"套餐名称",field:"packageName"},{title:"备注",field:"remark"},{title:"租户状态",field:"status",slots:{default:"status"}},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",width:180}],J=()=>[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"packageId"},{component:"Radio",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"menuCheckStrictly"},{component:"Input",fieldName:"packageName",label:"套餐名称",rules:"required"},{component:"menuIds",defaultValue:[],fieldName:"menuIds",label:"关联菜单"},{component:"Textarea",fieldName:"remark",formItemClass:"items-baseline",label:"备注"}],Q=_({name:"TreeItem",props:{data:{required:!0,type:Object}},setup(s,{expose:u}){u();const r=T(()=>{if(/^https?:\/\/[^\s/$.?#].\S*$/i.test(s.data.path))return{color:"pink",text:"外链"};const t=s.data.menuType;return t==="M"?{color:"green",text:"目录"}:t==="C"?{color:"blue",text:"菜单"}:t==="F"?{color:"",text:"按钮"}:{color:"error",text:"未知"}});return()=>m("div",{class:"flex gap-[6px]"},[m("span",null,[s.data.menuName]),m(B,{color:r.value.color},{default:()=>[r.value.text]})])}}),re=_({__name:"tenant-package-drawer",emits:["reload"],setup(s,{emit:u}){const r=u,t=y(!1),h=T(()=>t.value?x("pages.common.edit"):x("pages.common.add")),[w,o]=V({commonConfig:{formItemClass:"col-span-2"},layout:"vertical",schema:J(),showDefaultActions:!1,wrapperClass:"grid-cols-2"});function d(e){return i(this,null,function*(){if(e){const a=yield D(e);yield o.setFieldValue("menuIds",a.checkedKeys)}})}const n=y([]);function f(){return i(this,null,function*(){const e=yield L(),a=j(e,{id:"menuId"});n.value=a})}const[N,l]=U({onCancel:v,onConfirm:S,onOpenChange(e){return i(this,null,function*(){if(!e)return null;l.drawerLoading(!0);const{id:a}=l.getData();if(t.value=!!a,t.value&&a){const c=yield M(a);yield o.setValues(c)}yield Promise.all([f(),d(a)]),l.drawerLoading(!1)})}}),I=y();function S(){return i(this,null,function*(){var e,a,c;try{l.drawerLoading(!0);const{valid:p}=yield o.validate();if(!p)return;const F=(c=(a=(e=I.value)==null?void 0:e[0])==null?void 0:a.getCheckedKeys())!=null?c:[],k=P(yield o.getValues());k.menuIds=F,yield t.value?$(k):q(k),r("reload"),yield v()}catch(p){console.error(p)}finally{l.drawerLoading(!1)}})}function v(){return i(this,null,function*(){l.close(),yield o.resetForm()})}function b(e){o.setFieldValue("menuCheckStrictly",e)}return(e,a)=>(R(),K(g(N),{"close-on-click-modal":!1,title:h.value,class:"w-[600px]"},{default:C(()=>[m(g(w),null,{menuIds:C(c=>[m(g(A),O({ref_key:"menuSelectRef",ref:I},c,{"check-strictly":g(o).form.values.menuCheckStrictly,"expand-all-on-init":!0,"field-names":{title:"menuName",key:"menuId"},"tree-data":n.value,onCheckStrictlyChange:b}),{title:C(p=>[m(g(Q),{data:p},null,8,["data"])]),_:2},1040,["check-strictly","tree-data"])]),_:1})]),_:1},8,["title"]))}});export{re as _,ne as c,te as q};
