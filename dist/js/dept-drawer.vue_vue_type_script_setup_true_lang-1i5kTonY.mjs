var r=(e,w,i)=>new Promise((d,f)=>{var g=n=>{try{m(i.next(n))}catch(u){f(u)}},o=n=>{try{m(i.throw(n))}catch(u){f(u)}},m=n=>n.done?d(n.value):Promise.resolve(n.value).then(g,o);m((i=i.apply(e,w)).next())});import{I as c,K as h,s as y,$ as b}from"./bootstrap-CIlPtDbU.mjs";import{u as v}from"./vxe-table-CS5KFeE-.mjs";import{l as A}from"./index-DxROXI-t.mjs";import{g as D,r as $}from"./render-C5tDa4zc.mjs";import{g as N}from"./get-popup-container-BwMHEyJY.mjs";import{l as P,a as x}from"./tree-DR0G1ezI.mjs";import{a9 as B,Q as F,J as T,a3 as V,at as q,au as M,av as O,n as R,a8 as S}from"../jse/index-index-CulmqKVw.mjs";import{u as E}from"./use-drawer-0pSlBI5S.mjs";function k(e){return c.get("/system/dept/list",{params:e})}function U(e){return c.get(`/system/dept/list/exclude/${e}`)}function W(e){return c.get(`/system/dept/${e}`)}function Y(e){return c.postWithMsg("/system/dept",e)}function G(e){return c.putWithMsg("/system/dept",e)}function ae(e){return c.deleteWithMsg(`/system/dept/${e}`)}const oe=()=>[{component:"Input",fieldName:"deptName",label:"部门名称"},{component:"Select",componentProps:{getPopupContainer:N,options:D(h.SYS_NORMAL_DISABLE)},fieldName:"status",label:"部门状态"}],ne=[{field:"deptName",title:"部门名称",treeNode:!0,width:200},{field:"deptCategory",title:"类别编码"},{field:"orderNum",title:"排序",width:180},{field:"status",width:180,title:"状态",slots:{default:({row:e})=>$(e.status,h.SYS_NORMAL_DISABLE)}},{field:"createTime",title:"创建时间"},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",width:180}],J=()=>[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"deptId"},{component:"TreeSelect",componentProps:{getPopupContainer:N},dependencies:{show:e=>e.parentId!==0,triggerFields:["parentId"]},fieldName:"parentId",label:"上级部门",rules:"selectRequired"},{component:"Input",fieldName:"deptName",label:"部门名称",rules:"required"},{component:"InputNumber",fieldName:"orderNum",label:"显示排序",rules:"required"},{component:"Input",fieldName:"deptCategory",label:"类别编码"},{component:"Select",componentProps:{allowClear:!1,getPopupContainer:N},fieldName:"leader",label:"负责人"},{component:"Input",fieldName:"phone",label:"联系电话",rules:y().regex(/^1[3,4578]\d{9}$/,{message:"请输入正确的手机号"}).optional()},{component:"Input",fieldName:"email",label:"邮箱",rules:y().email({message:"请输入正确的邮箱"}).optional()},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:D(h.SYS_NORMAL_DISABLE),optionType:"button"},defaultValue:"0",fieldName:"status",label:"状态"}],se=B({__name:"dept-drawer",emits:["reload"],setup(e,{emit:w}){const i=w,d=F(!1),f=T(()=>d.value?b("pages.common.edit"):b("pages.common.add")),[g,o]=v({commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-2",labelWidth:80},schema:J(),showDefaultActions:!1,wrapperClass:"grid-cols-2"});function m(a,t=!1){return r(this,null,function*(){let s=[];s=yield!a||t?k({}):U(a);const l=P(s,{id:"deptId",pid:"parentId"});return x(l,"deptName"," / "),l})}function n(a){return r(this,null,function*(){const t=yield m(a,!d.value);o.updateSchema([{componentProps:{fieldNames:{label:"deptName",value:"deptId"},showSearch:!0,treeData:t,treeDefaultExpandAll:!0,treeLine:{showLeafIcon:!1},treeNodeLabelProp:"fullName"},fieldName:"parentId"}])})}function u(a){return r(this,null,function*(){const t=yield A(a),s=t.map(l=>({label:`${l.userName} | ${l.nickName}`,value:l.userId}));o.updateSchema([{componentProps:{disabled:t.length===0,options:s,placeholder:t.length===0?"该部门暂无用户":"请选择部门负责人"},fieldName:"leader"}])})}function L(){return r(this,null,function*(){o.updateSchema([{componentProps:{disabled:!0,options:[],placeholder:"仅在更新时可选部门负责人"},fieldName:"leader"}])})}const[_,p]=E({onCancel:I,onConfirm:C,onOpenChange(a){return r(this,null,function*(){if(!a)return null;p.drawerLoading(!0);const{id:t,update:s}=p.getData();if(d.value=s,t&&(yield o.setFieldValue("parentId",t),s)){const l=yield W(t);yield o.setValues(l)}yield s&&t?u(t):L(),yield n(t),p.drawerLoading(!1)})}});function C(){return r(this,null,function*(){try{p.drawerLoading(!0);const{valid:a}=yield o.validate();if(!a)return;const t=V(yield o.getValues());yield d.value?G(t):Y(t),i("reload"),yield I()}catch(a){console.error(a)}finally{p.drawerLoading(!1)}})}function I(){return r(this,null,function*(){p.close(),yield o.resetForm()})}return(a,t)=>(q(),M(S(_),{"close-on-click-modal":!1,title:f.value,class:"w-[600px]"},{default:O(()=>[R(S(g))]),_:1},8,["title"]))}});export{se as _,k as a,ne as c,ae as d,oe as q};
