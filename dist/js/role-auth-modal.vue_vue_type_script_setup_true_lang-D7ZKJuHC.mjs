var r=(y,f,s)=>new Promise((p,a)=>{var i=e=>{try{c(s.next(e))}catch(n){a(n)}},u=e=>{try{c(s.throw(e))}catch(n){a(n)}},c=e=>e.done?p(e.value):Promise.resolve(e.value).then(i,u);c((s=s.apply(y,f)).next())});import{u as V}from"./vxe-table-CS5KFeE-.mjs";import{d as x,e as D,f as I}from"./index-BQjO2Nl8.mjs";import{_ as B}from"./tree-select-panel.vue_vue_type_script_setup_true_lang-D0vP0S2i.mjs";import{a as F}from"./data-BPjxELxr.mjs";import{a9 as L,Q as _,a3 as A,at as M,au as T,av as g,n as k,a8 as m,ar as b}from"../jse/index-index-CulmqKVw.mjs";import{u as K}from"./use-modal-BmBYziM1.mjs";const q=L({__name:"role-auth-modal",emits:["reload"],setup(y,{emit:f}){const s=f,[p,a]=V({commonConfig:{componentProps:{class:"w-full"}},layout:"vertical",schema:F(),showDefaultActions:!1}),i=_([]);function u(t){return r(this,null,function*(){const o=yield I(t);a.setFieldValue("deptIds",o.checkedKeys),i.value=o.depts})}const[c,e]=K({fullscreenButton:!1,onCancel:C,onConfirm:w,onOpenChange:t=>r(this,null,function*(){if(!t)return null;e.modalLoading(!0);const{id:o}=e.getData();u(o);const l=yield x(o);yield a.setValues(l),e.modalLoading(!1)})}),n=_();function w(){return r(this,null,function*(){var t,o,l;try{e.modalLoading(!0);const{valid:h}=yield a.validate();if(!h)return;const d=A(yield a.getValues());if(d.dataScope==="2"){const v=(l=(o=(t=n.value)==null?void 0:t[0])==null?void 0:o.getCheckedKeys())!=null?l:[];d.deptIds=v}else d.deptIds=[];yield D(d),s("reload"),yield C()}catch(h){console.error(h)}finally{e.modalLoading(!1)}})}function C(){return r(this,null,function*(){e.close(),yield a.resetForm()})}function S(t){a.setFieldValue("deptCheckStrictly",t)}return(t,o)=>(M(),T(m(c),{"close-on-click-modal":!1,class:"min-h-[600px] w-[550px]",title:"分配权限"},{default:g(()=>[k(m(p),null,{deptIds:g(l=>[k(m(B),b({ref_key:"deptSelectRef",ref:n},l,{"check-strictly":m(a).form.values.deptCheckStrictly,"expand-all-on-init":!0,"tree-data":i.value,onCheckStrictlyChange:S}),null,16,["check-strictly","tree-data"])]),_:1})]),_:1}))}});export{q as _};
