var V=Object.defineProperty,$=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var I=(t,a,e)=>a in t?V(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,T=(t,a)=>{for(var e in a||(a={}))R.call(a,e)&&I(t,e,a[e]);if(m)for(var e of m(a))_.call(a,e)&&I(t,e,a[e]);return t},w=(t,a)=>$(t,q(a));var k=(t,a)=>{var e={};for(var s in t)R.call(t,s)&&a.indexOf(s)<0&&(e[s]=t[s]);if(t!=null&&m)for(var s of m(t))a.indexOf(s)<0&&_.call(t,s)&&(e[s]=t[s]);return e};var o=(t,a,e)=>new Promise((s,n)=>{var i=l=>{try{h(e.next(l))}catch(d){n(d)}},f=l=>{try{h(e.throw(l))}catch(d){n(d)}},h=l=>l.done?s(l.value):Promise.resolve(l.value).then(i,f);h((e=e.apply(t,a)).next())});import{bV as M,u as F,S as j}from"./bootstrap-CIlPtDbU.mjs";import{k as z,bE as G,bl as H,bm as J}from"../jse/index-index-CulmqKVw.mjs";const Q=M("core-tabbar",{actions:{_bulkCloseByPaths(t){return o(this,null,function*(){this.tabs=this.tabs.filter(a=>!t.includes(c(a))),this.updateCacheTabs()})},_close(t){const{fullPath:a}=t;if(r(t))return;const e=this.tabs.findIndex(s=>s.fullPath===a);e!==-1&&this.tabs.splice(e,1)},_goToDefaultTab(t){return o(this,null,function*(){if(this.getTabs.length<=0)return;const a=this.getTabs[0];a&&(yield this._goToTab(a,t))})},_goToTab(t,a){return o(this,null,function*(){const{params:e,path:s,query:n}=t,i={params:e||{},path:s,query:n||{}};yield a.replace(i)})},addTab(t){var s,n;const a=X(t);if(!Y(a))return;const e=this.tabs.findIndex(i=>c(i)===c(t));if(e===-1){const i=(n=(s=t==null?void 0:t.meta)==null?void 0:s.maxNumOfOpenTab)!=null?n:-1;if(i>0&&this.tabs.filter(f=>f.name===t.name).length>=i){const f=this.tabs.findIndex(h=>h.name===t.name);f!==-1&&this.tabs.splice(f,1)}this.tabs.push(a)}else{const i=z(this.tabs)[e],f=w(T(T({},i),a),{meta:T(T({},i==null?void 0:i.meta),a.meta)});if(i){const h=i.meta;Reflect.has(h,"affixTab")&&(f.meta.affixTab=h.affixTab),Reflect.has(h,"newTabTitle")&&(f.meta.newTabTitle=h.newTabTitle)}this.tabs.splice(e,1,f)}this.updateCacheTabs()},closeAllTabs(t){return o(this,null,function*(){const a=this.tabs.filter(e=>r(e));this.tabs=a.length>0?a:[...this.tabs].splice(0,1),yield this._goToDefaultTab(t),this.updateCacheTabs()})},closeLeftTabs(t){return o(this,null,function*(){const a=this.tabs.findIndex(n=>c(n)===c(t));if(a<1)return;const e=this.tabs.slice(0,a),s=[];for(const n of e)r(n)||s.push(c(n));yield this._bulkCloseByPaths(s)})},closeOtherTabs(t){return o(this,null,function*(){const a=this.tabs.map(s=>c(s)),e=[];for(const s of a)if(s!==t.fullPath){const n=this.tabs.find(i=>c(i)===s);if(!n)continue;r(n)||e.push(c(n))}yield this._bulkCloseByPaths(e)})},closeRightTabs(t){return o(this,null,function*(){const a=this.tabs.findIndex(e=>c(e)===c(t));if(a!==-1&&a<this.tabs.length-1){const e=this.tabs.slice(a+1),s=[];for(const n of e)r(n)||s.push(c(n));yield this._bulkCloseByPaths(s)}})},closeTab(t,a){return o(this,null,function*(){const{currentRoute:e}=a;if(c(e.value)!==c(t)){this._close(t),this.updateCacheTabs();return}const s=this.getTabs.findIndex(f=>c(f)===c(e.value)),n=this.getTabs[s-1],i=this.getTabs[s+1];i?(this._close(e.value),yield this._goToTab(i,a)):n?(this._close(e.value),yield this._goToTab(n,a)):console.error("Failed to close the tab; only one tab remains open.")})},closeTabByKey(t,a){return o(this,null,function*(){const e=decodeURIComponent(t),s=this.tabs.findIndex(i=>c(i)===e);if(s===-1)return;const n=this.tabs[s];n&&(yield this.closeTab(n,a))})},getTabByPath(t){return this.getTabs.find(a=>c(a)===t)},openTabInNewWindow(t){return o(this,null,function*(){const{hash:a,origin:e}=location,s=t.fullPath||t.path,n=s.startsWith("/")?s:`/${s}`,i=`${e}${a?"/#":""}${n}`;G(i,{target:"_blank"})})},pinTab(t){return o(this,null,function*(){const a=this.tabs.findIndex(e=>c(e)===c(t));a!==-1&&(t.meta.affixTab=!0,this.tabs.splice(a,1,t))})},refresh(t){return o(this,null,function*(){const{currentRoute:a}=t,{name:e}=a.value;this.excludeCachedTabs.add(e),this.renderRouteView=!1,H(),yield new Promise(s=>setTimeout(s,200)),this.excludeCachedTabs.delete(e),this.renderRouteView=!0,J()})},resetTabTitle(t){return o(this,null,function*(){var e;if(!((e=t==null?void 0:t.meta)!=null&&e.newTabTitle))return;const a=this.tabs.find(s=>c(s)===c(t));a&&(a.meta.newTabTitle=void 0,yield this.updateCacheTabs())})},setAffixTabs(t){for(const a of t)a.meta.affixTab=!0,this.addTab(Z(a))},setTabTitle(t,a){return o(this,null,function*(){const e=this.tabs.find(s=>c(s)===c(t));e&&(e.meta.newTabTitle=a,yield this.updateCacheTabs())})},setUpdateTime(){this.updateTime=Date.now()},sortTabs(t,a){return o(this,null,function*(){const e=this.tabs[t];e&&(this.tabs.splice(t,1),this.tabs.splice(a,0,e),this.dragEndIndex=this.dragEndIndex+1)})},toggleTabPin(t){return o(this,null,function*(){var e,s;yield((s=(e=t==null?void 0:t.meta)==null?void 0:e.affixTab)!=null?s:!1)?this.unpinTab(t):this.pinTab(t)})},unpinTab(t){return o(this,null,function*(){const a=this.tabs.findIndex(e=>c(e)===c(t));a!==-1&&(t.meta.affixTab=!1,this.tabs.splice(a,1,t))})},updateCacheTabs(){return o(this,null,function*(){var a;const t=new Set;for(const e of this.tabs){if(!((a=e.meta)==null?void 0:a.keepAlive))continue;(e.matched||[]).forEach((i,f)=>{f>0&&t.add(i.name)});const n=e.name;t.add(n)}this.cachedTabs=t})}},getters:{affixTabs(){return this.tabs.filter(a=>r(a)).sort((a,e)=>{var i,f,h,l;const s=(f=(i=a.meta)==null?void 0:i.affixTabOrder)!=null?f:0,n=(l=(h=e.meta)==null?void 0:h.affixTabOrder)!=null?l:0;return s-n})},getCachedTabs(){return[...this.cachedTabs]},getExcludeCachedTabs(){return[...this.excludeCachedTabs]},getTabs(){const t=this.tabs.filter(a=>!r(a));return[...this.affixTabs,...t].filter(Boolean)}},persist:[{pick:["tabs"],storage:sessionStorage}],state:()=>({cachedTabs:new Set,dragEndIndex:0,excludeCachedTabs:new Set,renderRouteView:!0,tabs:[],updateTime:Date.now()})});function X(t){if(!t)return t;const n=t,{matched:a,meta:e}=n,s=k(n,["matched","meta"]);return w(T({},s),{matched:a?a.map(i=>({meta:i.meta,name:i.name,path:i.path})):void 0,meta:w(T({},e),{newTabTitle:e.newTabTitle})})}function r(t){var a,e;return(e=(a=t==null?void 0:t.meta)==null?void 0:a.affixTab)!=null?e:!1}function Y(t){return!t.meta.hideInTab}function c(t){return decodeURIComponent(t.fullPath||t.path)}function Z(t){return{meta:t.meta,name:t.name,path:t.path}}function st(){const t=F(),a=j(),e=Q();function s(b){return o(this,null,function*(){yield e.closeLeftTabs(b||a)})}function n(){return o(this,null,function*(){yield e.closeAllTabs(t)})}function i(b){return o(this,null,function*(){yield e.closeRightTabs(b||a)})}function f(b){return o(this,null,function*(){yield e.closeOtherTabs(b||a)})}function h(b){return o(this,null,function*(){yield e.closeTab(b||a,t)})}function l(b){return o(this,null,function*(){yield e.pinTab(b||a)})}function d(b){return o(this,null,function*(){yield e.unpinTab(b||a)})}function v(b){return o(this,null,function*(){yield e.toggleTabPin(b||a)})}function A(){return o(this,null,function*(){yield e.refresh(t)})}function B(b){return o(this,null,function*(){yield e.openTabInNewWindow(b||a)})}function O(b){return o(this,null,function*(){yield e.closeTabByKey(b,t)})}function S(b){return o(this,null,function*(){e.setUpdateTime(),yield e.setTabTitle(a,b)})}function E(){return o(this,null,function*(){e.setUpdateTime(),yield e.resetTabTitle(a)})}function D(b=a){var P;const u=e.getTabs,C=e.affixTabs,x=u.findIndex(L=>L.path===b.path),g=u.length<=1,{meta:y}=b,N=(P=y==null?void 0:y.affixTab)!=null?P:!1,p=a.path===b.path,U=x===0||x-C.length<=0||!p,W=!p||x===u.length-1,K=g||!p||u.length-C.length<=1;return{disabledCloseAll:g,disabledCloseCurrent:!!N||g,disabledCloseLeft:U,disabledCloseOther:K,disabledCloseRight:W,disabledRefresh:!p}}return{closeAllTabs:n,closeCurrentTab:h,closeLeftTabs:s,closeOtherTabs:f,closeRightTabs:i,closeTabByKey:O,getTabDisableState:D,openTabInNewWindow:B,pinTab:l,refreshTab:A,resetTabTitle:E,setTabTitle:S,toggleTabPin:v,unpinTab:d}}export{Q as a,st as u};
