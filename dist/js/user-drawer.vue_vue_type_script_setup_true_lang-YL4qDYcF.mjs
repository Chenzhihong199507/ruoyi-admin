var p=(w,m,n)=>new Promise((s,d)=>{var c=l=>{try{i(n.next(l))}catch(a){d(a)}},e=l=>{try{i(n.throw(l))}catch(a){d(a)}},i=l=>l.done?s(l.value):Promise.resolve(l.value).then(c,e);i((n=n.apply(w,m)).next())});import{K as b,s as S,$ as _}from"./bootstrap-CIlPtDbU.mjs";import{u as V}from"./vxe-table-CS5KFeE-.mjs";import{f as D,d as L,e as k}from"./index-DxROXI-t.mjs";import{b as A}from"./data-BPjxELxr.mjs";import{g}from"./render-C5tDa4zc.mjs";import{g as T}from"./get-popup-container-BwMHEyJY.mjs";import{T as B}from"./index-BsPmTjuM.mjs";import{a9 as F,Q as O,J as R,a3 as q,at as E,au as U,av as Y,n as $,a8 as v,h as N}from"../jse/index-index-CulmqKVw.mjs";import{u as G}from"./use-drawer-0pSlBI5S.mjs";const ae=()=>[{component:"Input",fieldName:"userName",label:"用户账号"},{component:"Input",fieldName:"nickName",label:"用户昵称"},{component:"Select",componentProps:{getPopupContainer:T,options:g(b.SYS_NORMAL_DISABLE)},fieldName:"status",label:"用户状态"},{component:"RangePicker",fieldName:"createTime",label:"创建时间"}],oe=[{type:"checkbox",width:60},{field:"userName",title:"用户名称"},{field:"userBalance",title:"用户余额"},{field:"avatar",title:"头像",slots:{default:"avatar"},width:80},{field:"createTime",title:"创建时间"},{field:"loginDate",title:"最后登录时间"},{field:"status",title:"状态",slots:{default:"status"}},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",width:180}],M=()=>[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"userId"},{component:"Input",fieldName:"userName",label:"用户账号",rules:"required"},{component:"InputPassword",fieldName:"password",label:"用户密码",rules:"required"},{component:"Input",fieldName:"nickName",label:"用户昵称",rules:"required"},{component:"Input",fieldName:"phonenumber",label:"手机号码",defaultValue:void 0,rules:S().regex(/^1[3-9]\d{9}$/,"请输入正确的手机号码").optional()},{component:"Input",fieldName:"email",defaultValue:void 0,label:"邮箱",rules:S().email("请输入正确的邮箱").optional()},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:g(b.SYS_USER_SEX),optionType:"button"},defaultValue:"0",fieldName:"sex",formItemClass:"col-span-2 lg:col-span-1",label:"性别"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:g(b.SYS_NORMAL_DISABLE),optionType:"button"},defaultValue:"0",fieldName:"status",formItemClass:"col-span-2 lg:col-span-1",label:"状态"},{component:"Textarea",fieldName:"remark",formItemClass:"items-baseline",label:"备注"}],te=F({__name:"user-drawer",emits:["reload"],setup(w,{emit:m}){const n=m,s=O(!1),d=R(()=>s.value?_("pages.common.edit"):_("pages.common.add")),[c,e]=V({commonConfig:{formItemClass:"col-span-2",componentProps:{class:"w-full"},labelWidth:80},schema:M(),showDefaultActions:!1,wrapperClass:"grid-cols-2"});function i(o){const t=A.find(u=>u.value===o.dataScope);return t?N("div",{class:"flex items-center gap-[6px]"},[N("span",null,o.roleName),N(B,{color:t.color},()=>t.label)]):o.roleName}const[l,a]=G({onCancel:h,onConfirm:C,onOpenChange(o){return p(this,null,function*(){if(!o)return e.updateSchema([{componentProps:{options:[],placeholder:"请先选择部门"},fieldName:"postIds"}]),null;a.drawerLoading(!0);const{id:t}=a.getData();s.value=!!t,e.updateSchema([{componentProps:{disabled:s.value},fieldName:"userName"},{dependencies:{show:()=>!s.value,triggerFields:["id"]},fieldName:"password"}]);const{postIds:u,posts:f,roleIds:P,roles:y,user:I}=yield D(t),x=(f!=null?f:[]).map(r=>({label:r.postName,value:r.postId}));e.updateSchema([{componentProps:{optionLabelProp:"title",options:y.map(r=>({label:i(r),title:r.roleName,value:r.roleId}))},fieldName:"roleIds"},{componentProps:{options:x},fieldName:"postIds"}]),I&&(yield Promise.all([e.setValues(I),e.setFieldValue("postIds",u),e.setFieldValue("roleIds",P)])),a.drawerLoading(!1)})}});function C(){return p(this,null,function*(){try{a.drawerLoading(!0);const{valid:o}=yield e.validate();if(!o)return;const t=q(yield e.getValues());yield s.value?L(t):k(t),n("reload"),yield h()}catch(o){console.error(o)}finally{a.drawerLoading(!1)}})}function h(){return p(this,null,function*(){a.close(),yield e.resetForm()})}return(o,t)=>(E(),U(v(l),{"close-on-click-modal":!1,title:d.value,class:"w-[600px]"},{default:Y(()=>[$(v(c))]),_:1},8,["title"]))}});export{te as _,oe as c,ae as q};
