var m=(e,t,a)=>new Promise((r,d)=>{var y=o=>{try{u(a.next(o))}catch(n){d(n)}},i=o=>{try{u(a.throw(o))}catch(n){d(n)}},u=o=>o.done?r(o.value):Promise.resolve(o.value).then(y,i);u((a=a.apply(e,t)).next())});import{K as p,s as f,$ as w}from"./bootstrap-CIlPtDbU.mjs";import{u as _}from"./vxe-table-CS5KFeE-.mjs";import{b as C,c as P,d as D,a as x}from"./index-DV03ZwLB.mjs";import{g as h,m as T,r as S}from"./render-C5tDa4zc.mjs";import{g}from"./get-popup-container-BwMHEyJY.mjs";import{n as b,a9 as L,Q as A,J as V,a3 as E,at as O,au as M,av as R,a8 as F}from"../jse/index-index-CulmqKVw.mjs";import{u as k}from"./use-drawer-0pSlBI5S.mjs";import{l as q,a as B}from"./tree-DR0G1ezI.mjs";const Z=()=>[{component:"Input",fieldName:"menuName",label:"菜单名称 "},{component:"Select",componentProps:{getPopupContainer:g,options:h(p.SYS_NORMAL_DISABLE)},fieldName:"status",label:"菜单状态 "},{component:"Select",componentProps:{getPopupContainer:g,options:h(p.SYS_SHOW_HIDE)},fieldName:"visible",label:"显示状态"}],H=[{label:"目录",value:"M"},{label:"菜单",value:"C"},{label:"按钮",value:"F"}],I=[{label:"是",value:"0"},{label:"否",value:"1"}],W={M:{value:"目录",icon:"fxemoji:folder"},C:{value:"菜单",icon:"fluent-emoji-flat:open-book"},F:{value:"按钮",icon:"fluent-emoji:ok-button"}},ee=[{title:"菜单名称",field:"menuName",treeNode:!0,width:200},{title:"图标",field:"icon",width:80,slots:{default:({row:e})=>(e==null?void 0:e.icon)==="#"?"":T(e.icon)}},{title:"排序",field:"orderNum",width:120},{title:"组件类型",field:"menuType",width:150,slots:{default:({row:e})=>{const t=W[e.menuType];return t?b("span",{class:["flex","items-center","justify-center"]},[T(t.icon),b("span",{style:{marginLeft:"2px"}},[t.value])]):"未知"}}},{title:"权限标识",field:"perms"},{title:"组件路径",field:"component"},{title:"状态",field:"status",width:100,slots:{default:({row:e})=>S(e.status,p.SYS_NORMAL_DISABLE)}},{title:"显示",field:"visible",width:100,slots:{default:({row:e})=>S(e.visible,p.SYS_SHOW_HIDE)}},{title:"创建时间",field:"createTime"},{field:"action",fixed:"right",slots:{default:"action"},title:"操作",width:180}],Y=()=>[{component:"Input",dependencies:{show:()=>!1,triggerFields:[""]},fieldName:"menuId"},{component:"TreeSelect",defaultValue:0,fieldName:"parentId",label:"上级菜单",rules:"selectRequired"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:H,optionType:"button"},defaultValue:"M",dependencies:{componentProps:(e,t)=>(Object.keys(t.errors.value).forEach(a=>{t.setFieldError(a,void 0)}),{}),triggerFields:["menuType"]},fieldName:"menuType",label:"菜单类型"},{component:"Input",dependencies:{show:e=>e.menuType!=="F",triggerFields:["menuType"]},fieldName:"icon",help:"选择或者从 https://icon-sets.iconify.design/ 查找名称粘贴",label:"菜单图标"},{component:"Input",fieldName:"menuName",label:"菜单名称",rules:"required"},{component:"InputNumber",fieldName:"orderNum",help:"排序, 数字越小越靠前",label:"显示排序",rules:"required"},{component:"Input",componentProps:e=>({placeholder:e.isFrame==="0"?"填写链接地址http(s)://  使用新页面打开":"填写`路由地址`或者`链接地址`  链接默认使用内部iframe内嵌打开"}),dependencies:{rules:e=>e.isFrame!=="0"?f({message:"请输入路由地址"}).refine(t=>!t.startsWith("/"),{message:"路由地址不需要带/"}):f({message:"请输入链接地址"}).regex(/^https?:\/\//,{message:"请输入正确的链接地址"}),show:e=>e.menuType!=="F",triggerFields:["isFrame"]},fieldName:"path",help:"路由地址不带/, 如: menu, user 链接为http(s)://开头 链接默认使用内部iframe打开, 可通过{是否外链}控制打开方式",label:"路由地址"},{component:"Input",componentProps:e=>({disabled:e.isFrame==="0"}),defaultValue:"",dependencies:{rules:e=>e.path&&!/^https?:\/\//.test(e.path)?f().min(1,{message:"非链接时必填组件路径"}).refine(t=>!t.startsWith("/")&&!t.endsWith("/"),{message:"组件路径开头/末尾不需要带/"}):f().optional(),show:e=>e.menuType==="C",triggerFields:["menuType","path"]},fieldName:"component",help:"填写./src/views下的组件路径, 如system/menu/index",label:"组件路径"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:I,optionType:"button"},defaultValue:"1",dependencies:{show:e=>e.menuType!=="F",triggerFields:["menuType"]},fieldName:"isFrame",help:"外链为http(s)://开头 选择否时, 使用iframe从内部打开页面, 否则新窗口打开",label:"是否外链"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:h(p.SYS_SHOW_HIDE),optionType:"button"},defaultValue:"0",dependencies:{show:e=>e.menuType!=="F",triggerFields:["menuType"]},fieldName:"visible",help:"隐藏后不会出现在菜单栏, 但仍然可以访问",label:"是否显示"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:h(p.SYS_NORMAL_DISABLE),optionType:"button"},defaultValue:"0",dependencies:{show:e=>e.menuType!=="F",triggerFields:["menuType"]},fieldName:"status",help:"停用后不会出现在菜单栏, 也无法访问",label:"菜单状态"},{component:"Input",dependencies:{show:e=>e.menuType!=="M",triggerFields:["menuType"]},fieldName:"perms",help:'控制器中定义的权限字符, 如: @SaCheckPermission("system:user:import")',label:"权限标识"},{component:"Input",componentProps:e=>({disabled:e.isFrame==="0"}),dependencies:{show:e=>e.menuType==="C",triggerFields:["menuType"]},fieldName:"queryParam",help:'vue-router中的query属性, 如{"name": "xxx", "age": 16}',label:"路由参数"},{component:"RadioGroup",componentProps:{buttonStyle:"solid",options:I,optionType:"button"},defaultValue:"0",dependencies:{show:e=>e.menuType==="C",triggerFields:["menuType"]},fieldName:"isCache",help:"路由的keepAlive属性",label:"是否缓存"}],te=L({__name:"menu-drawer",emits:["reload"],setup(e,{emit:t}){const a=t,r=A(!1),d=V(()=>r.value?w("pages.common.edit"):w("pages.common.add")),[y,i]=_({commonConfig:{componentProps:{class:"w-full"},formItemClass:"col-span-2"},schema:Y(),showDefaultActions:!1,wrapperClass:"grid-cols-2"});function u(){return m(this,null,function*(){const s=yield x(),c=[{menuId:0,menuName:"根目录",children:q(s,{id:"menuId",pid:"parentId"})}];B(c,"menuName"," / "),i.updateSchema([{componentProps:{fieldNames:{label:"menuName",value:"menuId"},getPopupContainer:g,listHeight:300,showSearch:!0,treeData:c,treeDefaultExpandAll:!1,treeDefaultExpandedKeys:[0],treeLine:{showLeafIcon:!1},treeNodeFilterProp:"menuName",treeNodeLabelProp:"fullName"},fieldName:"parentId"}])})}const[o,n]=k({onCancel:N,onConfirm:v,onOpenChange(s){return m(this,null,function*(){if(!s)return null;n.drawerLoading(!0);const{id:l}=n.getData();if(r.value=!!l,yield u(),r.value&&l){const c=yield C(l);yield i.setValues(c)}n.drawerLoading(!1)})}});function v(){return m(this,null,function*(){try{n.drawerLoading(!0);const{valid:s}=yield i.validate();if(!s)return;const l=E(yield i.getValues());yield r.value?P(l):D(l),a("reload"),yield N()}catch(s){console.error(s)}finally{n.drawerLoading(!1)}})}function N(){return m(this,null,function*(){n.close(),yield i.resetForm()})}return(s,l)=>(O(),M(F(o),{"close-on-click-modal":!1,title:d.value,class:"w-[600px]"},{default:R(()=>[b(F(y))]),_:1},8,["title"]))}});export{te as _,ee as c,Z as q};
